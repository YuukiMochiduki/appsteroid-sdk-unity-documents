# インゲーム　ボイスチャットについて

## はじめに
インゲームボイスチャットは、ゲーム中にリアルタイムでグループ間でボイスチャットを行う機能です。
最大で４名のグループでグループボイスチャットが可能です。

## 手順とサンプル

### 事前準備
* AppSteroid の機能を利用するには、[GettingStarted](GettingStarted.md) に説明する初期設定を行っておく必要があります。
* ボイスチャットの着信はプッシュ通知を介して行われますので プッシュ通知の設定（[iOS]([Unity-iOS]プッシュ通知の設定方法.md) / [Android]([Unity-Android]プッシュ通知の設定方法.md))を行っておく必要があります。

### 着信時の動作設定
はじめに、以下のメソッドでゲーム中に着信した場合の動作を設定してください。ゲームの初期化処理などの任意のタイミングで行ってください。

    public static void SetIncomingVoiceChatBehavior(IncomingVoiceChatBehavior incomingVoiceChatBehavior)

着信時の動作を定義する　IncomingVoiceChatBehavior は以下のとおりです。デフォルトは Ask です。

|Value|description|
|-----|-----|
|Ask|確認ダイアログを表示してユーザーの応答を待ってカンファレンスへ接続する|
|AutoAccept|自動的にカンファレンスへ接続する|
|DoNothing|何もしない|

### ボイスチャットの発信

ボイスチャットの発信は以下のメソッドにより行います。ホストとしてグループボイスチャットを開始します。ホストがグループチャットを切断するとグループチャットが終了します。

    public static void StartConference(string groupId, Action<Error> startConferenceCallback, Action<Error> createConferenceCallback)


##### サンプルコード

    {
        FASConference.StartConference(Group.Id, OnGroupConferenceStartError, OnGroupConferenceCreateError);
    }
    
    void OnGroupConferenceStartError(Error error)
    {
        if (error != null)
        {
            Debug.LogError("GroupConferenceError : " + error.ToString());
        }
    }
    
    void OnGroupConferenceCreateError(Error error)
    {
        if (error != null)
        {
            Debug.LogError("GroupConferenceError : " + error.ToString());
        }
    }

### ボイスチャットの切断

ボイスチャットの接続後、以下のメソッドにより、ボイスチャットを切断します。ホストが切断した場合は、グループボイスチャットが終了します。ゲストが切断した場合は、ゲストユーザーのみ切断します。

    public static bool Leave()

###　ボイスチャットの着信

ボイスチャットの着信は、「着信時の動作設定」に応じて行われます。Ask、AutoAccept を設定した場合は着信処理をSDKが行いますので特に実装の必要はありません。

DoNothing を選択した場合は、着信通知イベントをハンドリングして、接続処理などを行ってください。下記にサンプルコードを示します。

#### DoNothing の場合の着信処理のサンプルコード

    // 1. グループカンファレンス作成通知のイベントを登録
    {
        FASEvent.OnGroupConferenceCreated += OnGroupConferenceCreated;
    }
    
    // 2. 着信時　グループカンファレンス作成通知イベントが発火
    void OnGroupConferenceCreated(GroupConference groupConference)
    {
        // グループカンファレンスにゲストとして参加
        FASConference.JoinConference(groupConference, OnGroupConferenceJoinError);
        
        // 通話中のエラーイベントの登録
        FASConference.OnError += OnGroupConferenceError;
    }
    
    // 参加時のエラー処理
    void OnGroupConferenceJoinError(Error error)
    {
        if (error != null)
        {
            Debug.LogError("GroupConferenceError : " + error.ToString());
        }
    }
    
    // 通話中エラー発生時の処理
    void OnGroupConferenceError(Error error)
    {
        Debug.LogError("GroupConferenceError : " + error.ToString());
    }


### その他の機能
[グループカンファレンスの操作クラス FASConference](Specs/Spec-FASConference.md) をご参照ください。
